= uCore-SMP Documentation and Specification
:author: Tianhua Tao
:email: taotianhua@outlook.com
:revnumber: 0.0.1
:sectnums:
:xrefstyle: short
:toc: macro

// table of contents
toc::[]

== Introduction

== Project Modules

[cols="1,2", width=70%, align="center", options="header"]
|===
| module      | description
| arch      |     CPU architecture
| driver    | Device driver code
| file  | File abstraction
| fs        | File system
| lock      | Kernel locks (spinlock & mutex)
| mem   | Memory (virtual & physical)
| proc  | Process
| sbi   | SBI call
| syscall   | System Call
| trap  | Trap handlers (interrupt & exception)
| ucore | Kernel definition and common headers
| utils | Utilities for kernel programming
|===

== Syscall

=== exec

[source, C]
----
int exec(char *path, const char **argv);
----

Start to execute the program at path `path`. `argv` will be passed to new program's `main()` function. `argv` should be a `NULL` terminated array of `char*` so that kernel will count the number of arguments and pass as `argc` to `main()`.

Note: New program's entrance is `int main(int argc, char* argv[]);`.

*Returns* -1 on error. Else no return.

=== exit

[source, C]
----
uint64 exit(int code);
----

Exit the running process with code `code`.

*Returns* 0. The syscall does not return.

=== read

[source, C]
----
int64 read(int fd, char *dst, uint64 len);
----

Read at most `len` bytes from file `fd` into `dst`.

*Returns* bytes count read. Or -1 if failed.

=== Compare with xv6

[cols="1,1,1", width=70%, align="center", options="header"]
|===
| syscall Name      | xv6 | uCore-SMP
| fork              | √ | √  
| exit              | √ | √  
| wait              | √ | √  
| pipe              | √ | √  
| read              | √ | √  
| kill              | √ | 
| exec              | √ | √  
| fstat             | √ | 
| chdir             | √ | √
| dup               | √ | √  
| getpid            | √ | √
| sbrk              | √ | 
| sleep             | √ | √ (yield)
| uptime            | √ | √ (times)
| open              | √ | √  
| write             | √ | √  
| mknod             | √ | √  
| unlink            | √ | 
| link              | √ | 
| mkdir             | √ | √
| close             | √ | √  
| setpriority       |  | √  
| getpriority       |  | √  
| gettimeofday      |  | √  
| spawn             |  | planed 
| mailread          |  | planed 
| mailwrite         |  | planed 
| mmap              |  | planed 
| munmap            |  | planed 
|===
